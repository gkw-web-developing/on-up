generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// Użytkownik
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String   @unique
  phone     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  billingAddress BillingAddress?
  orders         Order[]
}

// Adres rozliczeniowy
model BillingAddress {
  id         String  @id @default(cuid())
  city       String
  postalCode String
  street     String
  building   String
  apartment  String?

  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// Książka
model Book {
  id          String  @id @default(cuid())
  title       String  @unique
  slug        String  @unique
  description String? @db.Text
  price       Decimal @db.Decimal(10, 2)
  imageUrl    String?
  stock       Int     @default(0)

  qualifications BookQualification[]
  professions    BookProfession[]
  orderItems     OrderItem[]
}

// Kwalifikacja zawodowa (np. SPL.03, HAN.01)
model Qualification {
  id   String @id @default(cuid())
  code String @unique // SPL.03, SPL.04, HAN.01 itp.

  books BookQualification[]

  @@index([code])
}

// Zawód/Kategoria (np. Technik logistyk)
model Profession {
  id   String @id @default(cuid())
  name String @unique // "Technik logistyk", "Technik handlowiec"

  books BookProfession[]
}

// Tabela pośrednia: Książka - Kwalifikacja (Many-to-Many)
model BookQualification {
  bookId          String
  qualificationId String

  book          Book          @relation(fields: [bookId], references: [id], onDelete: Cascade)
  qualification Qualification @relation(fields: [qualificationId], references: [id], onDelete: Cascade)

  @@id([bookId, qualificationId])
  @@index([bookId])
  @@index([qualificationId])
}

// Tabela pośrednia: Książka - Zawód (Many-to-Many)
model BookProfession {
  bookId       String
  professionId String

  book       Book       @relation(fields: [bookId], references: [id], onDelete: Cascade)
  profession Profession @relation(fields: [professionId], references: [id], onDelete: Cascade)

  @@id([bookId, professionId])
  @@index([bookId])
  @@index([professionId])
}

// Zamówienie
model Order {
  id          String      @id @default(cuid())
  orderNumber String      @unique @default(cuid())
  status      OrderStatus @default(PENDING)
  totalAmount Decimal     @db.Decimal(10, 2)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  userId String
  user   User   @relation(fields: [userId], references: [id])

  items OrderItem[]

  @@index([userId])
}

// Pozycja zamówienia
model OrderItem {
  id       String  @id @default(cuid())
  quantity Int
  price    Decimal @db.Decimal(10, 2)

  orderId String
  order   Order  @relation(fields: [orderId], references: [id], onDelete: Cascade)

  bookId String
  book   Book   @relation(fields: [bookId], references: [id])

  @@index([orderId])
  @@index([bookId])
}

// Enum dla statusu zamówienia
enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}
